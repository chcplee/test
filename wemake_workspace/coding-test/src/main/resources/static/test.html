<!DOCTYPE html>
<html>
<head>

<style>
	#frmDiv{
		text-align:center;
		margin-bottom:15px;
	}
	#frmTbl{
		width: 500px;
		border-top: 2px solid rgb(222,221,226);
		border-bottom: 2px solid rgb(222,221,226);
		border-left:0px;
		border-right:0px;
		border-spacing: 0px;
		display: inline-block;
	}
	#frmTbl th{
		width: 150px;
		height: 35px;
		padding: 0px;
		margin: 0px;
		border-right : 1px solid rgb(222,221,226);
		border-bottom : 1px solid rgb(222,221,226);
		background-color : #f0f0f1;
		font-size: 10pt;
		font-weight: bold;
	}
	#frmTbl th:last-child{
		border-bottom : none;
	}
	#frmTbl td{
		width: 350px;
		padding: 0px;
		margin: 0px;
		border-bottom : 1px solid rgb(222,221,226);
	}
	.al{
		text-align:left;
	}
</style>
<script type="text/javascript" src="js/jquery/jquery-2.1.1.min.js"></script>
<script type="text/javascript">

function requestService(reqData){
	var oReq = null;
	if (window.XMLHttpRequest) {
		// code for modern browsers
		oReq = new XMLHttpRequest();
	} else {
	   // code for old IE browsers
		oReq = new ActiveXObject("Microsoft.XMLHTTP");
	}
	
	console.log(reqData);
	
	oReq.addEventListener("load", function(){
		 // console.log(this.responseText);
		  //console.log(this.status);
		  var obj = JSON.parse(this.responseText);
		  if(this.status =="200"){
			  console.log("success");
			  var obj = JSON.parse(this.responseText);
			  //console.log(obj.resourceId);
			  updateResult(obj);
			  //window.location.href = obj.responseText;
		  }else{
			  console.log("fail");
			  //console.log(obj.msg);
			  alert("서버 내부 에러 발생 : " + this.status);
		  }
	});
	var host =  window.location.protocol + "//" + window.location.host;
	oReq.open("POST", host+"/print");
	oReq.setRequestHeader("Content-type", "application/json;charset=euc-kr")
	oReq.setRequestHeader("accept", "*")
	var msg = JSON.stringify(reqData);
	console.log(msg);
	oReq.send(msg);
	
}

function updateResult(responseDto){
	alert("결과를 받아왔습니다");	
	var quotient = document.getElementById("quotient");
	var remainder = document.getElementById("remainder");
	quotient.value=responseDto.quotient;
	remainder.value=responseDto.remainder;
	
}


function getHtmlByRequestURL(url){
	var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", url, false ); // false for synchronous request
    xmlHttp.send( null );
    return xmlHttp.responseText;
}

function printOuput(){
	var url = document.getElementById("url");
	var type = document.getElementById("parsingType");
	var count = document.getElementById("groupCount");
	var index = $("#parsingType option").index($("#parsingType option:selected"));

	console.log("URL : " + url.value + ", index : " +index+ ",count : " + count.value);
	
	var reqData = new Object();
	reqData.url=url.value;
	if( index === 1){
		reqData.option="WITHOUT_TAG";	
	}else{
		reqData.option="FULLTEXT";
	}
	//reqData.url=getHtmlByRequestURL(url.value);
	reqData.url=url.value;
	reqData.groupCount=count.value;
	console.log(reqData);
	
	requestService(reqData);
	/*
	var requestUrl = 'http://localhost:8080/print';
	console.log("request URL : "+requestUrl);
	$.ajax({
		url:requestUrl,
		type:'POST',
		contentType:'application/json; charset=UTF-8',
		data:JSON.stringify(reqData),
		dataType:'JSON',
		async:true,
		success: function(data, textStatus, jqXHR){
			if(jqXHR.status == '<c:out value="${HttpStatus.OK}"/>'){
				alert('성공');

			}else{
				alert('실패하였습니다.');
			}
		}, error: function(xhr, ajaxOptions, thrownError){
			var responseJSON = xhr.responseJSON;
			alert(responseJSON.message+'{status-code :'+xhr.status+', status : '+responseJSON.status+', message : '+responseJSON.debugMessage+'}');
		}
	})
	*/
}
</script>
<meta charset="UTF-8">
<title>위메프 코딩 테스트</title>
</head>
<body>
<div id="frmDiv">
	<div>
	    <table id="frmTbl">
						<tr>
							<th><label>URL</label></th>
							<td><input type="text" id="url"></td>
						</tr>
						<tr>
							<th><label>Type</label></th>
							<td>
								<select id="parsingType">
									<option value="" selected disabled>타입 선택</option>
									<option id="htmlWithoutTag">Html 태그 제외</option>
									<option id="fullText">Text 전체</option>
								</select>
							</td>
						</tr>
						<tr>
							<th><label>출력 묶음</label></th>
							<td><input type="text" id="groupCount"></td>
						</tr>
		</table>
	    <button type="button" class="btn btn-default" onClick="printOuput()">출력</button>
    </div>
    <div id="outArea">
    	<div>
    	<label>몫 출력 </label>
    	<textarea id="quotient" name="quotient" rows="10" cols="30"></textarea>
    	</div>
    	<div>
    	<label>나머지 출력</label>
    	<textarea id="remainder" name="remainder" rows="10" cols="30"></textarea>
    	</div>
    </div>
</div>
</body>
</html>